"use strict";var App=angular.module("bandmateApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]);App.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.tpl",controller:"LoginCtrl"}).when("/studio",{templateUrl:"views/studio.tpl",controller:"StudioCtrl"}).when("/edit/:id",{templateUrl:"views/edit.tpl",controller:"EditCtrl"}).when("/search",{templateUrl:"views/search.tpl",controller:"SearchCtrl"}).otherwise({redirectTo:"/"})}]),App.run(["$firebaseSimpleLogin","$rootScope",function(a,b){var c=new Firebase("https://bandmate.firebaseio.com");b.loginObject=a(c)}]),App.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter,{event:b})}),b.preventDefault())})}}),App.filter("toArray",function(){return function(a){return a instanceof Object?Object.keys(a).filter(function(a){return"$"!==a.charAt(0)?a:void 0}).map(function(b){return Object.defineProperty(a[b],"$key",{__proto__:null,value:b})}):a}}),angular.module("bandmateApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("bandmateApp").factory("FireConn",["$firebase",function(a){var b="https://bandmate.firebaseIO.com",c=new Firebase(b);return a(c)}]),App.controller("LoginCtrl",["$firebaseSimpleLogin","$rootScope","FireConn","$window","$cookies",function(a,b,c,d,e){function f(){var a=new Firebase("https://bandmate.firebaseio.com"),c=[],f=!0;a.on("child_added",function(a){c.push(a.val())});for(var g=0;g<c.length;g++)c[g].id===b.currentUser.id?(f=!0,b.currentUser=c[g]):f=!1;f||a.child(b.currentUser.id).set(b.currentUser),e.id=b.currentUser.id,e.name=b.currentUser.name,e.imgUrl=b.currentUser.imgUrl,console.log(f),d.location.href="#/studio"}b.loginUser=function(){b.loginObject.$login("twitter").then(function(a){console.log(a),b.currentUser={id:a.provider+a.id,name:a.name,location:a.location,imgUrl:a.profile_image_url},console.log("meow",b.currentUser),f()},function(a){console.log(a,"user auth failed")})}}]),App.controller("LogoutCtrl",["$firebaseSimpleLogin","$rootScope","$window","$cookies",function(a,b,c){b.logoutUser=function(){b.loginObject.$logout(),b.currentUser="",c.location.href="#/"}}]),App.controller("StudioCtrl",["$scope","$rootScope","FireConn","$cookies","$filter",function(a,b,c,d){void 0===b.currentUser&&(b.currentUser={id:d.id,name:d.name,imgUrl:d.imgUrl}),a.studioUsers=[];var e=(new Firebase("https://bandmate.firebaseio.com/"),new Firebase("https://bandmate.firebaseio.com/"+b.currentUser.id+"/studio"));e.on("child_added",function(b){a.studioUsers.push(b.val())}),a.addToStudio=function(a){({age:a.age,email:a.email,facebook:a.facebook,genre:a.genre,id:a.id,imgUrl:a.imgUrl,location:a.location,name:a.name,phone:a.phone,skills:a.skills,soundcloud:a.soundcloud,twitter:a.twitter,youtube:a.youtube});console.log("add",a),e.push(a.id)}}]),App.controller("EditCtrl",["$scope","$rootScope","FireConn","$firebase","$routeParams","$cookies",function(a,b,c,d,e,f){void 0===b.currentUser&&(b.currentUser={id:f.id,name:f.name,imgUrl:f.imgUrl});var g=new Firebase("https://bandmate.firebaseio.com/"+e.id);a.user=d(g),a.save=function(){null!==a.user.name&&g.update({name:a.user.name}),null!==a.user.age&&g.update({age:a.user.age}),null!==a.user.location&&g.update({location:a.user.location}),null!==a.user.email&&g.update({email:a.user.email}),null!==a.user.phone&&g.update({phone:a.user.phone}),null!==a.user.skills&&g.update({skills:a.user.skills}),null!==a.user.genre&&g.update({genre:a.user.genre}),null!==a.user.facebook&&g.update({facebook:a.user.facebook}),null!==a.user.twitter&&g.update({twitter:a.user.twitter}),null!==a.user.soundcloud&&g.update({soundcloud:a.user.soundcloud}),null!==a.user.youtube&&g.update({youtube:a.user.youtube}),console.log("saved")}}]),App.controller("SearchCtrl",["$scope","FireConn","$window","$filter","$rootScope","$cookies",function(a,b,c,d,e,f){function g(){i=[],j.on("child_added",function(a){a.val().skills===h&&(console.log("match"),i.push(a.val()))}),e.results=i,console.log(a.results),c.location.href="#/search"}void 0===e.currentUser&&(e.currentUser={id:f.id,name:f.name,imgUrl:f.imgUrl});var h="",i=[];a.search=function(){console.log("search",a.searchKeywords),h=a.searchKeywords,g()};var j=new Firebase("https://bandmate.firebaseio.com")}]);