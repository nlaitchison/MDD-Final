"use strict";var App=angular.module("bandmateApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]);App.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.tpl",controller:"LoginCtrl"}).when("/studio/:id",{templateUrl:"views/studio.tpl",controller:"StudioCtrl"}).when("/edit/:id",{templateUrl:"views/edit.tpl",controller:"EditCtrl"}).when("/:id/search/:keywords",{templateUrl:"views/search.tpl",controller:"SearchCtrl"}).otherwise({redirectTo:"/"})}]),App.run(["$firebaseSimpleLogin","$rootScope","$location","$firebase","FireUser",function(a,b,c,d,e){var f=new Firebase("https://bandmate.firebaseio.com");b.loginObject=a(f),b.$on("$firebaseSimpleLogin:login",function(a,d){var f=d.provider+d.id;b.currentUser=e(f),b.currentUser.id=f,b.currentUser.imgUrl=d.profile_image_url,"/"===c.path()&&c.path("/studio/"+b.currentUser.id),console.log("root",b.currentUser.id)}),b.search=function(){c.path("/"+b.currentUser.id+"/search/"+b.searchKeywords)}}]),App.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter,{event:b})}),b.preventDefault())})}}),App.filter("toArray",function(){return function(a){return a instanceof Object?Object.keys(a).filter(function(a){return"$"!==a.charAt(0)?a:void 0}).map(function(b){return Object.defineProperty(a[b],"$key",{__proto__:null,value:b})}):a}}),App.filter("removeStudio",function(){return function(a){for(var b=a.length-1;b>=0;b--)a[b].studio=null;return a}}),angular.module("bandmateApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("bandmateApp").factory("FireConn",["$firebase",function(a){var b="https://bandmate.firebaseIO.com/",c=new Firebase(b);return a(c)}]).factory("FireUser",["$firebase",function(a){return function(b){var c="https://bandmate.firebaseIO.com/"+b,d=new Firebase(c);return a(d)}}]).factory("FireStudio",["$firebase",function(a){return function(b){var c="https://bandmate.firebaseIO.com/"+b+"/studio/",d=new Firebase(c);return a(d)}}]),App.controller("LoginCtrl",["$firebaseSimpleLogin","$rootScope","FireConn","$location",function(a,b,c,d){function e(){var a=new Firebase("https://bandmate.firebaseio.com"),c=[],e=!0;a.on("child_added",function(a){c.push(a.val())});for(var f=0;f<c.length;f++)c[f].id===b.currentUser.id?(e=!0,b.currentUser=c[f]):e=!1;e||a.child(b.currentUser.id).set(b.currentUser),d.path("/studio/"+b.currentUser.id)}b.loginUser=function(){b.loginObject.$login("twitter").then(function(a){b.currentUser={id:a.provider+a.id,name:a.name,location:a.location,imgUrl:a.profile_image_url},e()},function(a){console.log(a,"user auth failed")})}}]),App.controller("LogoutCtrl",["$firebaseSimpleLogin","$rootScope","$window",function(a,b,c){b.logoutUser=function(){b.loginObject.$logout(),b.currentUser="",c.location.href="#/"}}]),App.controller("StudioCtrl",["$scope","$routeParams","$firebase",function(a,b,c){var d=new Firebase("https://bandmate.firebaseio.com/"+b.id+"/studio");a.studioUsers=c(d),a.addToStudio=function(b){null!=a.studioUsers[b.id]?a.studioUsers.$remove(b.id):(a.studioUsers[b.id]=b,a.studioUsers.$save(b.id))}}]),App.controller("EditCtrl",["$scope","$firebase","$routeParams",function(a,b,c){var d=new Firebase("https://bandmate.firebaseio.com/"+c.id);a.user=b(d),a.save=function(){a.user.$save()}}]),App.controller("SearchCtrl",["$scope","FireConn","$routeParams","$firebase",function(a,b,c){a.searchKeywords=c.keywords,a.results=b}]);